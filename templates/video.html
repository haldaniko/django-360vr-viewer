{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>360Â° DASH Video Player</title>
  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  <script src="https://cdn.dashjs.org/latest/dash.all.min.js"></script>
  <link rel="stylesheet" href="{% static 'css/video360.css' %}">
</head>
<body>

<header class="header">
  <div class="header__container">
    <div class="header__spacer"></div>
    <h1 class="header__title">360vr</h1>
    <nav class="header__lang">
      <ul class="header__lang-list">
        <li class="header__lang-item"><a href="?lang=en" class="header__lang-link">EN</a></li>
        <li class="header__lang-item"><a href="?lang=de" class="header__lang-link">DE</a></li>
        <li class="header__lang-item"><a href="?lang=ua" class="header__lang-link">UA</a></li>
        <li class="header__lang-item"><a href="?lang=ru" class="header__lang-link">RU</a></li>
      </ul>
    </nav>
  </div>
</header>


<main>
  <div id="player-container">
    <video id="video360" playsinline crossorigin="anonymous" webkit-playsinline muted></video>
    <a-scene vr-mode-ui="enabled: true" embedded>
      <a-videosphere id="videosphere" src="#video360" rotation="0 -90 0" visible="false"></a-videosphere>
      <a-camera look-controls="pointerLockEnabled: true" wasd-controls-enabled="false"></a-camera>
    </a-scene>
    <div id="playButton">Play</div>
  </div>
</main>

<footer class="footer">
  <div class="footer__container">
    <div class="footer__column">
      <h3 class="footer__title">Contact</h3>
      <p class="footer__text">Email: example@vrps.com</p>
      <p class="footer__text">Phone: +1 (123) 456-7890</p>
    </div>
    <div class="footer__column">
      <h3 class="footer__title">Contact</h3>
      <p class="footer__text">Email: example@vrps.com</p>
      <p class="footer__text">Phone: +1 (123) 456-7890</p>
    </div>
    <div class="footer__column">
      <h3 class="footer__title">Contact</h3>
      <p class="footer__text">Email: example@vrps.com</p>
      <p class="footer__text">Phone: +1 (123) 456-7890</p>
    </div>
  </div>
</footer>




<script>
  const video = document.getElementById('video360');
  const playButton = document.getElementById('playButton');
  const videosphere = document.getElementById('videosphere');
  const url = "{{ dash_manifest_url }}";

  const player = dashjs.MediaPlayer().create();

  player.updateSettings({
    streaming: {
      buffer: {
        stableBufferTime: 3,
        bufferTimeAtTopQuality: 5,
        bufferTimeAtTopQualityLongForm: 8,
        fastSwitchEnabled: true
      }
    }
  });

  player.initialize(video, url, false);

  player.on(dashjs.MediaPlayer.events.ERROR, (e) => {
    console.error('Dash.js error:', e);
    if (e.error && e.error.code === 'QuotaExceededError') {
      player.reset();
      player.initialize(video, url, false);
      video.pause();
      if (videosphere) videosphere.setAttribute('visible', 'false');
    }
  });

  video.addEventListener('loadeddata', () => {
    if (videosphere) videosphere.setAttribute('visible', 'true');
  });

  playButton.addEventListener('click', () => {
    player.play();
    video.muted = false;
    video.play().catch(e => console.error('Video play failed:', e));
    playButton.style.display = 'none';
  });
</script>

</body>
</html>