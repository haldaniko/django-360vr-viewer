{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <title>360Â° Video Player</title>
  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  <script src="https://cdn.dashjs.org/latest/dash.all.min.js"></script>
  <link rel="stylesheet" href="{% static 'css/video360.css' %}">
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body>

<!-- Header -->
<header class="header">
  <div class="header__container">
    <h1 class="header__title">Name of the Project</h1>
    <nav class="header__lang">
      <ul class="header__lang-list">
        <li class="header__lang-item"><a href="?lang=tr" class="header__lang-link">TR</a></li>
        <li class="header__lang-item"><a href="?lang=en" class="header__lang-link--active">EN</a></li>
        <li class="header__lang-item"><a href="?lang=fr" class="header__lang-link">FR</a></li>
        <li class="header__lang-item"><a href="?lang=ua" class="header__lang-link">UA</a></li>
        <li class="header__lang-item"><a href="?lang=bg" class="header__lang-link">BG</a></li>
      </ul>
    </nav>
  </div>
</header>

<!-- Main -->
<main>
  <!-- About -->
  <section class="about">
    <h2 class="about__title">About</h2>
    <p class="about__description">
      Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aenean euismod bibendum ante, non hendrerit mauris
      convallis id. Maecenas in lorem eu quam malesuada gravida et ut nulla. Nam dignissim ex ut quam rhoncus tristique.
      Nunc posuere nisl eget orci porttitor, eget finibus nibh aliquam. Donec a elit pretium, accumsan velit luctus,
      congue est. Aliquam et lacinia massa. Nullam non sagittis arcu. Mauris tristique purus vitae tempus cursus. Nunc
      faucibus nisi vitae lectus condimentum dignissim. Praesent at turpis a quam aliquet sollicitudin sed et metus.
      Proin dignissim consectetur velit nec finibus. Praesent gravida tincidunt lacus nec eleifend. Ut vel blandit
      lectus.
    </p>
  </section>

  <!-- Partners -->
  <section class="partners">
    <div class="partners__container">
      <h2 class="partners__title">Our Partners</h2>
      <div class="partners__list">
        <div class="partners__card">
          <img src="{% static 'img/partner1.jpg' %}" alt="Partner 1 Logo" class="partners__image"/>
          <p class="partners__description">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec ut rhoncus
            nisl. Praesent vitae velit nulla. Sed eu ante lacus. Suspendisse nec mauris purus. Quisque dignissim ipsum
            metus, id scelerisque felis fringilla eu.
          </p>
        </div>
        <div class="partners__card">
          <img src="{% static 'img/partner1.jpg' %}" alt="Partner 2 Logo" class="partners__image"/>
          <p class="partners__description">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec ut rhoncus
            nisl. Praesent vitae velit nulla. Sed eu ante lacus. Suspendisse nec mauris purus. Quisque dignissim ipsum
            metus, id scelerisque felis fringilla eu.
          </p>
        </div>
        <div class="partners__card">
          <img src="{% static 'img/partner1.jpg' %}" alt="Partner 3 Logo" class="partners__image"/>
          <p class="partners__description">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec ut rhoncus
            nisl. Praesent vitae velit nulla. Sed eu ante lacus. Suspendisse nec mauris purus. Quisque dignissim ipsum
            metus, id scelerisque felis fringilla eu.
          </p>
        </div>
      </div>
    </div>
  </section>


  <!-- Video -->
  <section class="video">
    <div class="video__container">
      <div class="video__player-wrapper">
        <video
            id="video360"
            class="video__element"
            playsinline
            crossorigin="anonymous"
            webkit-playsinline
            muted
        ></video>

        <a-scene vr-mode-ui="enabled: true" embedded class="video__scene">
          <a-videosphere
              id="videosphere"
              src="#video360"
              rotation="0 -90 0"
              visible="false"
          ></a-videosphere>
          <a-camera
              look-controls="pointerLockEnabled: true"
              wasd-controls-enabled="false"
          ></a-camera>
        </a-scene>

        <div class="video__play-button" id="playButton" aria-label="Play"></div>
      </div>
    </div>
  </section>

</main>

<!-- Footer -->
<footer class="footer">
  <div class="footer__container">
    <div class="footer__column">
      <h3 class="footer__title">Contact</h3>
      <p class="footer__text">Email: example@vrps.com</p>
      <p class="footer__text">Phone: +1 (123) 456-7890</p>
    </div>
    <div class="footer__column">
      <h3 class="footer__title">Contact</h3>
      <p class="footer__text">Email: example@vrps.com</p>
      <p class="footer__text">Phone: +1 (123) 456-7890</p>
    </div>
    <div class="footer__column">
      <h3 class="footer__title">Contact</h3>
      <p class="footer__text">Email: example@vrps.com</p>
      <p class="footer__text">Phone: +1 (123) 456-7890</p>
    </div>
  </div>
</footer>


<script>
    const video = document.getElementById('video360');
    const playButton = document.getElementById('playButton');
    const videosphere = document.getElementById('videosphere');
    const url = "{{ dash_manifest_url }}";

    const player = dashjs.MediaPlayer().create();

    player.updateSettings({
        streaming: {
            buffer: {
                stableBufferTime: 3,
                bufferTimeAtTopQuality: 5,
                bufferTimeAtTopQualityLongForm: 8,
                fastSwitchEnabled: true
            }
        }
    });

    player.initialize(video, url, false);

    player.on(dashjs.MediaPlayer.events.ERROR, (e) => {
        console.error('Dash.js error:', e);
        if (e.error && e.error.code === 'QuotaExceededError') {
            player.reset();
            player.initialize(video, url, false);
            video.pause();
            if (videosphere) videosphere.setAttribute('visible', 'false');
        }
    });

    video.addEventListener('loadeddata', () => {
        if (videosphere) videosphere.setAttribute('visible', 'true');
    });

    playButton.addEventListener('click', () => {
        player.play();
        video.muted = false;
        video.play().catch(e => console.error('Video play failed:', e));
        playButton.style.display = 'none';
    });
</script>

</body>
</html>