{% load static %}

{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Inner World</title>
  <link rel="icon" type="image/x-icon" href="{% static 'img/favicon.ico' %}">
  <link rel="stylesheet" href="{% static 'css/video360.css' %}">
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">

  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  <script src="https://cdn.dashjs.org/latest/dash.all.min.js"></script>
</head>
<body>

<header class="header">
  <div class="header__container">
    <a href="{% url 'website:about' %}?lang=en">
      <div class="header__info">
        <img class="header__erasmus" alt="EU" src="{% static 'img/eu-logo-en.jpg' %}">
        <img class="header__logo" alt="logo" src="{% static 'img/inner_world_logo.png' %}">
        <h1 class="header__title">Virtual Reality Platform<br> for Psychosocial Support</h1>
      </div>
    </a>
    <nav class="header__lang">
      <ul class="header__lang-list">
        <li class="header__lang-item"><a href="?lang=en" class="header__lang-link--active">EN</a></li>
        <li class="header__lang-item"><a href="?lang=tr" class="header__lang-link">TR</a></li>
        <li class="header__lang-item"><a href="?lang=fr" class="header__lang-link">FR</a></li>
        <li class="header__lang-item"><a href="?lang=ua" class="header__lang-link">UA</a></li>
        <li class="header__lang-item"><a href="?lang=bg" class="header__lang-link">BG</a></li>
      </ul>
    </nav>
  </div>
</header>

<!-- Main Content -->
<main>

  <!-- Instructions -->
  <section class="about">
    <h2 class="about__title">VRPS Instructions</h2>
    <div class="about__description">
      <p>The InnerWorld project developed accessible, youthâ€‘friendly mental-health support methods. These five short VR
        videos are simple, skillsâ€‘based tools you can use on your own to support your mental health. They are not
        therapy or clinical treatment. If you are in crisis, think you might harm yourself or someone else, or your
        symptoms worsen, contact local emergency services or a qualified mental health professional.<br><br>

        Choose a safe, comfortable place where you can sit or lie down. If you feel dizzy, nauseous,
        numb, or disconnected at any point, stop the video, open your eyes, look around the room, and
        switch to the grounding exercise below. If you are using headphones or a VR headset, remove
        them immediately if you feel unwell. If you have a respiratory or cardiac condition, are pregnant,
        or find breathâ€‘holding uncomfortable, shorten the counts or skip breathâ€‘hold steps.
      </p>

      <div class="about__cards">
        <a href="{% static 'docs/VR videos guide for direct users.pdf' %}" target="_blank">
          <div class="about__card">
            ðŸ“„ Guide for direct users.pdf
          </div>
        </a>

        <a href="{% static 'docs/VR videos guide for professionals.pdf' %}" target="_blank">
          <div class="about__card">
            ðŸ“„ Guide for professionals.pdf
          </div>
        </a>

      </div>
    </div>
  </section>

  <!-- Video -->
  <section class="video">
    <div class="video__container">

      <!-- Thumbnails (centered above the player) -->
      <div class="video__thumbnails">
        <button class="video__thumbnail video__thumbnail--active"
                aria-label="Video 1">
          <img src="{% static 'img/cinema.png' %}" alt="Video 1">
          <span class="video__label">Waterfall</span>
        </button>
        <button class="video__thumbnail" aria-label="Video 2">
          <img src="{% static 'img/grounding.png' %}" alt="Video 2">
          <span class="video__label">Grounding</span>
        </button>
        <button class="video__thumbnail" aria-label="Video 3">
          <img src="{% static 'img/scan.png' %}" alt="Video 3">
          <span class="video__label">Cinema</span>
        </button>
        <button class="video__thumbnail" aria-label="Video 4">
          <img src="{% static 'img/triangle.png' %}" alt="Video 4">
          <span class="video__label">Scanning</span>
        </button>
        <button class="video__thumbnail" aria-label="Video 5">
          <img src="{% static 'img/waterfall.png' %}" alt="Video 5">
          <span class="video__label">Triangle Breath</span>
        </button>
      </div>

      <!-- Player -->
      <div class="video__player-wrapper">
        <video
            id="video360"
            class="video__element"
            playsinline
            crossorigin="anonymous"
            webkit-playsinline
            muted
        ></video>

        <a-scene renderer="antialias: true; precision: highp;" vr-mode-ui="enabled: true" embedded class="video__scene">
          <a-videosphere
              id="videosphere"
              src="#video360"
              rotation="0 -90 0"
              visible="false"
          ></a-videosphere>
          <a-camera
              look-controls="pointerLockEnabled: true"
              wasd-controls-enabled="false"
          ></a-camera>
        </a-scene>

        <div class="video__play-button" id="playButton" aria-label="Play"></div>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="footer">
    <div class="footer__container">
      <div class="footer__column">
        <h3 class="footer__title">ABU contacts</h3>
        <p class="footer__text">Email: info@ankarabilim.edu.tr</p>
        <p class="footer__text">Phone: +90 552 899 84 11</p>
        <p class="footer__text">Website:
          <a class="footer__link" target="_blank" href="https://ankarabilim.edu.tr/en/index">
            ankarabilim.edu.tr
          </a>
        </p>

      </div>
      <div class="footer__column">
        <h3 class="footer__title">FSCOD contacts</h3>
        <p class="footer__text">Email: contact@opendoors.center</p>
        <p class="footer__text">Phone: +359 884 013 786</p>
        <p class="footer__text">Website:
          <a class="footer__link" target="_blank" href="https://opendoors.center/">
            opendoors.center
          </a>
        </p>

      </div>
      <div class="footer__column">
        <h3 class="footer__title">URC contacts</h3>
        <p class="footer__text">Email: olena.vyshnev@gmail.com</p>
        <p class="footer__text">Phone: +33 065 245 56 39</p>
        <p class="footer__text">Instagram:
          <a class="footer__link" target="_blank" href="https://www.instagram.com/ukrrcenter/">
            @ukrrcenter
          </a>
        </p>

      </div>
      <div class="footer__column">
        <h3 class="footer__title">Guides & Docs</h3>
        <p class="footer__text">
          <a href="{% static 'docs/VR videos guide for direct users.pdf' %}" target="_blank">
            ðŸ“„ Guide for direct users.pdf
          </a>
        </p>
        <p class="footer__text">
          <a href="{% static 'docs/VR videos guide for professionals.pdf' %}" target="_blank">
            ðŸ“„ Guide for professionals.pdf
          </a>
        </p>
        <p class="footer__text">
          <a href="{% static 'docs/Who-5English.pdf' %}" target="_blank">
            ðŸ“„ Who-5English.pdf
          </a>
        </p>
      </div>
      <div class="footer__column">
        <h3 class="footer__title">Regulations</h3>
        <p class="footer__text">
          <a href="{% static 'docs/Privacy Policy.pdf' %}" target="_blank">
            ðŸ“„ Privacy Policy.pdf
          </a>
        </p>
        <p class="footer__text">
          <a href="{% static 'docs/Terms of Use.pdf' %}" target="_blank">
            ðŸ“„ Terms of Use.pdf
          </a>
        </p>
        <p class="footer__text">
          <a href="{% static 'docs/Incident Report template.docx' %}" target="_blank">
            ðŸ“„ Incident Report template.docx
          </a>
        </p>
      </div>
    </div>
    <div class="footer__bottom">
      <hr class="footer__divider">
      <p class="footer__copy">
        InnerWorld: Virtual Reality for Psychosocial Support<br>
        2023-3-TR01-KA210-YOU-000181712<br>
        Â© 2025 All rights reserved.
      </p>
    </div>
  </footer>

</main>

<script>
    const video = document.getElementById('video360');
    const playButton = document.getElementById('playButton');
    const videosphere = document.getElementById('videosphere');
    const camera = document.querySelector('a-camera');

    let player = dashjs.MediaPlayer().create();
    player.updateSettings({
        streaming: {
            buffer: {
                stableBufferTime: 3,
                bufferTimeAtTopQuality: 5,
                bufferTimeAtTopQualityLongForm: 8,
                fastSwitchEnabled: true
            }
        }
    });

    let currentUrl = "{{ cinema_dash_manifest_url }}";
    player.initialize(video, currentUrl, false);

    player.on(dashjs.MediaPlayer.events.ERROR, (e) => {
        console.error('Dash.js error:', e);
        if (e.error && e.error.code === 'QuotaExceededError') {
            player.reset();
            player.initialize(video, currentUrl, false);
            video.pause();
            if (videosphere) videosphere.setAttribute('visible', 'false');
            playButton.style.display = '';
        }
    });

    video.addEventListener('loadeddata', () => {
        if (videosphere) videosphere.setAttribute('visible', 'true');
    });

    playButton.addEventListener('click', () => {
        startVideo();
    });

    document.addEventListener('keydown', (e) => {
        if (e.code === 'Space') {
            e.preventDefault();
            toggleVideo();
        }
    });

    if (videosphere) {
        videosphere.addEventListener('click', () => {
            if (video.paused) {
                startVideo(false);
            }
        });
    }

    function startVideo() {
        player.play();
        video.muted = false;
        video.play().catch(e => console.error('Video play failed:', e));
        playButton.style.display = 'none';
    }

    function pauseVideo() {
        video.pause();
        playButton.style.display = '';
    }

    function toggleVideo() {
        if (video.paused) {
            startVideo();
        } else {
            pauseVideo();
        }
    }

    const urlMap = {
        0: "{{ cinema_dash_manifest_url }}",
        1: "{{ grounding_dash_manifest_url }}",
        2: "{{ scan_dash_manifest_url }}",
        3: "{{ triangle_dash_manifest_url }}",
        4: "{{ waterfall_dash_manifest_url }}"
    };

    const thumbnails = document.querySelectorAll('.video__thumbnail');
    thumbnails.forEach((thumb, index) => {
        thumb.addEventListener('click', () => {
            thumbnails.forEach(t => t.classList.remove('video__thumbnail--active'));
            thumb.classList.add('video__thumbnail--active');

            const url = urlMap[index];
            currentUrl = url;

            player.reset();
            player.initialize(video, url, false);
            video.muted = false;

            if (videosphere) videosphere.setAttribute('visible', 'true');

            playButton.style.display = '';
        });
    });

    if (camera) {
        const controls = camera.components['look-controls'];
        if (controls) {
            controls.pointerLockEnabled = false;
            controls.mouseEnabled = true;
        }
    }
</script>

</body>
</html>