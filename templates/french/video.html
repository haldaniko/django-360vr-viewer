{% load static %}

<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Inner World</title>
  <link rel="icon" type="image/x-icon" href="{% static 'img/favicon.ico' %}">
  <link rel="stylesheet" href="{% static 'css/video360.css' %}">
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">

  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  <script src="https://cdn.dashjs.org/latest/dash.all.min.js"></script>
</head>
<body>

<!-- En-t√™te -->
<header class="header">
  <div class="header__container">
    <a href="{% url 'website:about' %}?lang=fr">
      <div class="header__info">
        <img class="header__logo" alt="logo" src="{% static 'img/logo-fr2.png' %}">
        <img class="header__tua-logo" alt="tua-logo" src="{% static 'img/tua-logo.png' %}">
        <img class="header__yazisiz-logo" alt="yazisiz-logo" src="{% static 'img/yazisiz-logo.jpg' %}">
        <img class="header__erasmus" alt="eu-log" src="{% static 'img/eu-logo-fr.jpg' %}">
      </div>
    </a>
    <nav class="header__nav">
      <ul class="header__nav-list">
        <li class="header__nav-item">
          <a href="{% url 'website:about' %}?lang=fr" class="header__nav-link">Maison</a>
        </li>
        <li class="header__nav-item">
          <a href="{% url 'website:video' %}?lang=fr" class="header__nav-link header__nav-link--active">VR</a>
        </li>
        <li class="header__nav-item">
          <a href="{% url 'website:howitworks' %}?lang=fr" class="header__nav-link">Comment √ßa marche</a>
        </li>
        <li class="header__nav-item">
          <a href="{% url 'website:guides' %}?lang=fr" class="header__nav-link">Guides</a>
        </li>
        <li class="header__nav-item">
          <a href="{% url 'website:results' %}?lang=fr" class="header__nav-link">R√©sultats</a>
        </li>
      </ul>
    </nav>
    <nav class="header__lang">
      <ul class="header__lang-list">
        <li class="header__lang-item"><a href="?lang=en" class="header__lang-link">EN</a></li>
        <li class="header__lang-item"><a href="?lang=tr" class="header__lang-link">TR</a></li>
        <li class="header__lang-item"><a href="?lang=fr" class="header__lang-link--active">FR</a></li>
        <li class="header__lang-item"><a href="?lang=ua" class="header__lang-link">UA</a></li>
        <li class="header__lang-item"><a href="?lang=bg" class="header__lang-link">BG</a></li>
      </ul>
    </nav>
  </div>
</header>

<!-- Contenu principal -->
<main>
  <!-- VRPS text -->
  <section class="vrps">
    <div class="vrps__container">
      <h2 class="vrps__title">Exp√©riences VR InnerWorld</h2>

      <p class="vrps__text">
        Le projet InnerWorld a d√©velopp√© des m√©thodes de soutien √† la sant√© mentale accessibles et adapt√©es aux jeunes.
        Ces cinq courtes vid√©os en VR sont des outils simples et bas√©s sur des comp√©tences que vous pouvez utiliser seul
        pour soutenir
        votre bien-√™tre mental. Elles ne constituent pas une th√©rapie ni un traitement clinique. Si vous √™tes en crise,
        pensez que vous
        pourriez vous faire du mal ou faire du mal √† quelqu'un d'autre, ou si vos sympt√¥mes s'aggravent, veuillez
        contacter les services
        d'urgence locaux ou un professionnel qualifi√© de la sant√© mentale.
      </p>

      <p class="vrps__text">
        Choisissez un endroit s√ªr et confortable o√π vous pouvez vous asseoir ou vous allonger. Si vous ressentez des
        vertiges, des naus√©es,
        un engourdissement ou une d√©connexion √† tout moment, arr√™tez la vid√©o, ouvrez les yeux, regardez autour de vous
        et
        passez √† l'exercice de mise √† la terre ci-dessous. Si vous utilisez un casque audio ou un casque VR, retirez-le
        imm√©diatement
        si vous ne vous sentez pas bien. Si vous avez des probl√®mes respiratoires ou cardiaques, √™tes enceinte ou
        vous sentez mal √† l'aise en retenant votre respiration, r√©duisez le nombre de comptages ou sautez les √©tapes de
        r√©tention du souffle.
      </p>
    </div>
  </section>

  <!-- Vid√©o -->
  <section class="video">
    <div class="video__container">

      <!-- Vignettes (centr√©es au-dessus du lecteur) -->
      <div class="video__thumbnails">
        <button class="video__thumbnail video__thumbnail--active"
                aria-label="Vid√©o 1">
          <img src="{% static 'img/cinema.png' %}" alt="Vid√©o 1">
          <span class="video__label">Cascade</span>
        </button>
        <button class="video__thumbnail" aria-label="Vid√©o 2">
          <img src="{% static 'img/grounding.png' %}" alt="Vid√©o 2">
          <span class="video__label">Ancrage</span>
        </button>
        <button class="video__thumbnail" aria-label="Vid√©o 3">
          <img src="{% static 'img/scan.png' %}" alt="Vid√©o 3">
          <span class="video__label">Cin√©ma</span>
        </button>
        <button class="video__thumbnail" aria-label="Vid√©o 4">
          <img src="{% static 'img/triangle.png' %}" alt="Vid√©o 4">
          <span class="video__label">Balayage</span>
        </button>
        <button class="video__thumbnail" aria-label="Vid√©o 5">
          <img src="{% static 'img/waterfall.png' %}" alt="Vid√©o 5">
          <span class="video__label">Respiration Triangle</span>
        </button>
      </div>


      <!-- Lecteur -->
      <div class="video__player-wrapper">
        <video
            id="video360"
            class="video__element"
            playsinline
            crossorigin="anonymous"
            webkit-playsinline
            muted
        ></video>

        <a-scene vr-mode-ui="enabled: true" embedded class="video__scene">
          <a-videosphere
              id="videosphere"
              src="#video360"
              rotation="0 -90 0"
              visible="false"
          ></a-videosphere>
          <a-camera
              look-controls="pointerLockEnabled: true"
              wasd-controls-enabled="false"
          ></a-camera>
        </a-scene>

        <div class="video__play-button" id="playButton" aria-label="Lecture"></div>
      </div>
    </div>
  </section>

  <!-- Sections -->
  <section class="practices">
    <div class="practices__container">
      <div class="practices__grid">

        <article class="practice-card">
          <h3 class="practice-card__title">Respiration Triangle</h3>
          <p class="practice-card__intro">Pour calmer votre corps et ralentir.</p>

          <p class="practice-card__label">√Ä utiliser lorsque :</p>
          <p class="practice-card__text">Vous vous sentez stress√©, press√© ou tendu.</p>

          <p class="practice-card__label">Ce que cela fait :</p>
          <ul class="practice-card__list">
            <li>Ralentit votre respiration</li>
            <li>Aide votre corps √† se d√©tendre</li>
            <li>R√©duit les r√©actions au stress</li>
          </ul>

          <p class="practice-card__note">
            Respirez doucement. Si vous avez des √©tourdissements, arr√™tez et passez √† l'exercice de mise √† la terre.
          </p>
        </article>

        <article class="practice-card">
          <h3 class="practice-card__title">Respiration Carr√©</h3>
          <p class="practice-card__intro">Pour la concentration, l'√©quilibre et l'attention stable.</p>

          <p class="practice-card__label">√Ä utiliser lorsque :</p>
          <p class="practice-card__text">Vous avez besoin de vous concentrer ou vous sentez anxieux.</p>

          <p class="practice-card__label">Ce que cela fait :</p>
          <ul class="practice-card__list">
            <li>Apporte un rythme √† votre respiration</li>
            <li>Aide √† stabiliser vos pens√©es</li>
            <li>Favorise la concentration</li>
          </ul>

          <p class="practice-card__note">
            Le confort est plus important que la pr√©cision. Vous pouvez raccourcir ou sauter les retenues de souffle.
          </p>
        </article>

        <article class="practice-card">
          <h3 class="practice-card__title">Scan Corporel</h3>
          <p class="practice-card__intro">Pour rel√¢cher la tension et se d√©tendre profond√©ment.</p>

          <p class="practice-card__label">√Ä utiliser lorsque :</p>
          <p class="practice-card__text">Votre corps se sent tendu ou agit√©.</p>

          <p class="practice-card__label">Ce que cela fait :</p>
          <ul class="practice-card__list">
            <li>Vous aide √† percevoir votre corps en toute s√©curit√©</li>
            <li>Favorise la relaxation et le repos</li>
            <li>Peut am√©liorer le sommeil</li>
          </ul>

          <p class="practice-card__note">
            Si un inconfort appara√Æt, ouvrez les yeux ou passez √† la mise √† la terre.
          </p>
        </article>

        <article class="practice-card practice-card--caution">
          <h3 class="practice-card__title">Cin√©ma (Inqui√©tudes comme un Film)</h3>
          <p class="practice-card__intro">Pour prendre du recul face aux pens√©es inqui√©tantes.</p>

          <p class="practice-card__label">√Ä utiliser lorsque :</p>
          <p class="practice-card__text">Les inqui√©tudes tournent en boucle dans votre esprit.</p>

          <p class="practice-card__label">Ce que cela fait :</p>
          <ul class="practice-card__list">
            <li>Cr√©e une distance avec les pens√©es</li>
            <li>R√©duit l'intensit√© √©motionnelle</li>
            <li>Favorise la clart√© mentale</li>
          </ul>

          <p class="practice-card__warning">
            Gardez cet exercice court. √âvitez-le si les inqui√©tudes sont accablantes ou traumatisantes.
          </p>
        </article>

        <article class="practice-card practice-card--safe">
          <h3 class="practice-card__title">Exercice de Mise √† la Terre</h3>
          <p class="practice-card__intro">Pour se sentir pr√©sent et stable √† nouveau.</p>

          <p class="practice-card__label">√Ä utiliser lorsque :</p>
          <p class="practice-card__text">
            Vous vous sentez d√©pass√©, d√©connect√© ou dans la lune.
          </p>

          <p class="practice-card__label">Ce que cela fait :</p>
          <ul class="practice-card__list">
            <li>Vous reconnecte avec le moment pr√©sent</li>
            <li>Vous aide √† vous sentir en s√©curit√© dans votre corps</li>
            <li>R√©duit la surcharge √©motionnelle</li>
          </ul>

          <p class="practice-card__note">
            C'est l'exercice le plus s√ªr. Vous pouvez revenir √† la mise √† la terre √† tout moment.
          </p>
        </article>

      </div>

      <div class="practices__guide">
        <h3 class="practices__guide-title">Quel exercice choisir ?</h3>

        <ul class="practices__guide-list">
          <li><strong>Anxieux ou stress√© ?</strong> Respiration Triangle ou Carr√©</li>
          <li><strong>Les pens√©es ne s'arr√™tent pas ?</strong> Cin√©ma ‚Üí ou Mise √† la Terre si intense</li>
          <li><strong>D√©connect√© ou submerg√© ?</strong> Mise √† la Terre (meilleur choix)</li>
          <li><strong>Le corps est tendu ?</strong> Scan Corporel</li>
          <li><strong>Envie de se d√©tendre ou de dormir ?</strong> Scan Corporel ou Respiration Triangle</li>
        </ul>

        <p class="practices__guide-note">
          Encore incertain ? Choisissez la Mise √† la Terre ‚Äî c'est l'option la plus simple et la plus s√ªre.
        </p>
      </div>

      <div class="practices__safety">
        <p>
          Vous pouvez arr√™ter n'importe quel exercice √† tout moment. Si vous vous sentez √©tourdi ou mal √† l'aise,
          faites une pause, retirez le casque et reconnectez-vous √† vos sensations corporelles.
        </p>
      </div>

    </div>
  </section>

  <!-- Pied de page -->
  <footer class="footer">
    <div class="footer__container">
      <div class="footer__column">
        <h3 class="footer__title">Contacts ABU</h3>
        <p class="footer__text">Email : info@ankarabilim.edu.tr</p>
        <p class="footer__text">T√©l√©phone : +90 552 899 84 11</p>
        <p class="footer__text">Site web :
          <a class="footer__link" target="_blank" href="https://ankarabilim.edu.tr/en/index">
            ankarabilim.edu.tr
          </a>
        </p>
      </div>
      <div class="footer__column">
        <h3 class="footer__title">Contacts FSCOD</h3>
        <p class="footer__text">Email : contact@opendoors.center</p>
        <p class="footer__text">T√©l√©phone : +359 884 013 786</p>
        <p class="footer__text">Site web :
          <a class="footer__link" target="_blank" href="https://opendoors.center/">
            opendoors.center
          </a>
        </p>
      </div>
      <div class="footer__column">
        <h3 class="footer__title">Contacts URC</h3>
        <p class="footer__text">Email : olena.vyshnev@gmail.com</p>
        <p class="footer__text">T√©l√©phone : +33 065 245 56 39</p>
        <p class="footer__text">Instagram :
          <a class="footer__link" target="_blank" href="https://www.instagram.com/ukrrcenter/">
            @ukrrcenter
          </a>
        </p>
      </div>
      <div class="footer__column">
        <h3 class="footer__title">Guides & Documents</h3>
        <p class="footer__text">
          <a href="{% static 'docs/VR videos guide for direct users.pdf' %}" target="_blank">
            üìÑ Guide for direct users.pdf
          </a>
        </p>
        <p class="footer__text">
          <a href="{% static 'docs/VR videos guide for professionals.pdf' %}" target="_blank">
            üìÑ Guide for professionals.pdf
          </a>
        </p>
        <p class="footer__text">
          <a href="{% static 'docs/Who-5French.pdf' %}" target="_blank">
            üìÑ Who-5French.pdf
          </a>
        </p>
      </div>
      <div class="footer__column">
        <h3 class="footer__title">R√®glements</h3>
        <p class="footer__text">
          <a href="{% static 'docs/Privacy Policy.pdf' %}" target="_blank">
            üìÑ Privacy Policy.pdf
          </a>
        </p>
        <p class="footer__text">
          <a href="{% static 'docs/Terms of Use.pdf' %}" target="_blank">
            üìÑ Terms of Use.pdf
          </a>
        </p>
        <p class="footer__text">
          <a href="{% static 'docs/Incident Report template.docx' %}" target="_blank">
            üìÑ Incident Report template.docx
          </a>
        </p>
      </div>
    </div>
    <div class="footer__bottom">
      <hr class="footer__divider">
      <p class="footer__copy">
        InnerWorld: Virtual Reality for Psychosocial Support
      <p>Financ√© par l‚ÄôUnion europ√©enne. Les points de vue et avis exprim√©s n‚Äôengagent toutefois que leur(s) auteur(s)
        et ne refl√®tent pas n√©cessairement ceux de l‚ÄôUnion europ√©enne ou de l‚ÄôAgence<br> ex√©cutive europ√©enne pour
        l‚Äô√©ducation et la culture (EACEA). Ni l‚ÄôUnion europ√©enne ni l‚ÄôEACEA ne sauraient en √™tre tenues pour
        responsables.</p>
      2023-3-TR01-KA210-YOU-000181712<br>
      ¬© 2025 Tous droits r√©serv√©s.
      </p>
    </div>
  </footer>

</main>

<script>
    const video = document.getElementById('video360');
    const playButton = document.getElementById('playButton');
    const videosphere = document.getElementById('videosphere');
    const camera = document.querySelector('a-camera');

    let player = dashjs.MediaPlayer().create();
    player.updateSettings({
        streaming: {
            buffer: {
                stableBufferTime: 3,
                bufferTimeAtTopQuality: 5,
                bufferTimeAtTopQualityLongForm: 8,
                fastSwitchEnabled: true
            }
        }
    });

    let currentUrl = "{{ cinema_dash_manifest_url }}";
    player.initialize(video, currentUrl, false);

    player.on(dashjs.MediaPlayer.events.ERROR, (e) => {
        console.error('Dash.js error:', e);
        if (e.error && e.error.code === 'QuotaExceededError') {
            player.reset();
            player.initialize(video, currentUrl, false);
            video.pause();
            if (videosphere) videosphere.setAttribute('visible', 'false');
            playButton.style.display = '';
        }
    });

    video.addEventListener('loadeddata', () => {
        if (videosphere) videosphere.setAttribute('visible', 'true');
    });

    playButton.addEventListener('click', () => {
        startVideo();
    });

    document.addEventListener('keydown', (e) => {
        if (e.code === 'Space') {
            e.preventDefault();
            toggleVideo();
        }
    });

    if (videosphere) {
        videosphere.addEventListener('click', () => {
            if (video.paused) {
                startVideo(false);
            }
        });
    }

    function startVideo() {
        player.play();
        video.muted = false;
        video.play().catch(e => console.error('Video play failed:', e));
        playButton.style.display = 'none';
    }

    function pauseVideo() {
        video.pause();
        playButton.style.display = '';
    }

    function toggleVideo() {
        if (video.paused) {
            startVideo();
        } else {
            pauseVideo();
        }
    }

    const urlMap = {
        0: "{{ cinema_dash_manifest_url }}",
        1: "{{ grounding_dash_manifest_url }}",
        2: "{{ scan_dash_manifest_url }}",
        3: "{{ triangle_dash_manifest_url }}",
        4: "{{ waterfall_dash_manifest_url }}"
    };

    const thumbnails = document.querySelectorAll('.video__thumbnail');
    thumbnails.forEach((thumb, index) => {
        thumb.addEventListener('click', () => {
            thumbnails.forEach(t => t.classList.remove('video__thumbnail--active'));
            thumb.classList.add('video__thumbnail--active');

            const url = urlMap[index];
            currentUrl = url;

            player.reset();
            player.initialize(video, url, false);
            video.muted = false;

            if (videosphere) videosphere.setAttribute('visible', 'true');

            playButton.style.display = '';
        });
    });

    if (camera) {
        const controls = camera.components['look-controls'];
        if (controls) {
            controls.pointerLockEnabled = false;
            controls.mouseEnabled = true;
        }
    }
</script>

</body>
</html>
